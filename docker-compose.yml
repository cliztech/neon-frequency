version: '3.8'

services:
  # THE TRANSMITTER (Icecast2)
  icecast:
    image: infiniteproject/icecast
    ports:
      - "8000:8000"
    environment:
      - ICECAST_SOURCE_PASSWORD=hackme
      - ICECAST_ADMIN_PASSWORD=hackme
      - ICECAST_PASSWORD=hackme
      - ICECAST_RELAY_PASSWORD=hackme
    networks:
      - radio-net

  # THE DECK (Liquidsoap)
  liquidsoap:
    image: savonet/liquidsoap:v2.2.5
    volumes:
      - ./broadcast/liquidsoap:/etc/liquidsoap
      - ./music:/music
      - audio_cache:/audio_cache
    ports:
      - "1234:1234" # Telnet Control Port
    command: liquidsoap /etc/liquidsoap/radio.liq
    depends_on:
      - icecast
    networks:
      - radio-net

  # THE BRAIN (Python Cortex)
  brain:
    build: .
    volumes:
      - ./music:/music
      - audio_cache:/audio_cache
      - .env:/app/.env
    environment:
      - LIQUIDSOAP_HOST=liquidsoap
      - AUDIO_CACHE_DIR=/audio_cache
    depends_on:
      - liquidsoap
    networks:
      - radio-net

volumes:
  audio_cache:

networks:
  radio-net:
