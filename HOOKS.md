# Event Hooks & Automation

This document defines the **Event-Driven Architecture** for Neon Frequency. Hooks trigger actions based on system state changes.

## ðŸŸ¢ Pre-Broadcast Hooks
*Triggered before a track or segment goes air.*

### `hook_validate_audio`
- **Trigger**: Track selected by `CrateDigger`.
- **Action**: Check file existence, valid format (MP3/FLAC), and Loudness (LUFS).
- **Fallback**: If failed, replace with "Emergency Cart".

### `hook_content_safety`
- **Trigger**: Script generated by `TalentParams`.
- **Action**: Scan for FCC banned words or extreme sentiment.
- **Fallback**: Regenerate prompt with higher "safety" parameters.

---

## ðŸ”´ On-Air Hooks
*Triggered during live playback.*

### `hook_now_playing`
- **Trigger**: `DeckMaster` reports new track start.
- **Action**:
    1. Update Website Metadata (JSON push).
    2. Notify `HypeMachine` to tweet.
    3. Update OSC visualizer stream.

### `hook_dead_air`
- **Trigger**: RMS level < -40dB for > 5 seconds.
- **Action**:
    1. **Emergency**: Fire `LiveAssist` "Backup Loop".
    2. **Alert**: Trigger `SRE_Sentinel` log event.
    3. **Recover**: Force-skip current track in Liquidsoap.

---

## ðŸ”µ Post-Broadcast Hooks
*Triggered after a show or hour block.*

### `hook_perf_audit`
- **Trigger**: Hour clock completion.
- **Action**:
    1. Calculate "Timing Drift" (Did we end on time?).
    2. Log listener peak/drop-off points.
    3. Save `PlayLog` to CSV for ASCAP.

## Implementation Guide
Hooks should be implemented as Async Event Listeners in `cortex.py`.
```python
async def on_track_start(event):
    await update_metadata(event.track)
    await hype_machine.post_update(event.track)
```
